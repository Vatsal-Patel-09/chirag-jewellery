<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account - Ashirwaad Jewelry</title>
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="../style.css">
</head>

<body>
    <div class="home_black_version">
        <!-- Minimal header -->
        <header class="header_area header_black">
            <div class="header_middel">
                <div class="container">
                    <div class="row align-items-center justify-content-center">
                        <div class="col-auto">
                            <div class="logo" style="padding:0;">
                                <a href="../index.html"><img src="../images/logo/logo-ash.png" alt="Ashirwaad"></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- My Account Section -->
        <section class="auth_section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8 col-md-10 col-12">
                        <div class="account_card">
                            <!-- User Info -->
                            <div class="account_header">
                                <div class="account_avatar">
                                    <i class="ion-person"></i>
                                </div>
                                <div class="account_info">
                                    <h2 id="account_name">-</h2>
                                    <p id="account_email">-</p>
                                    <p id="account_phone" style="color:#a0a0a0;font-size:13px;"></p>
                                </div>
                                <button class="auth_btn auth_btn_small" onclick="Auth.logout()">
                                    <i class="ion-log-out"></i> Logout
                                </button>
                            </div>

                            <!-- Account Tabs -->
                            <div class="account_tabs">
                                <button class="account_tab active" data-tab="orders">
                                    <i class="ion-bag"></i> My Orders
                                </button>
                                <button class="account_tab" data-tab="settings">
                                    <i class="ion-gear-a"></i> Settings
                                </button>
                            </div>

                            <!-- Orders Tab -->
                            <div class="account_tab_content active" id="tab_orders">
                                <div id="orders_loading" class="account_empty">
                                    <i class="ion-load-c"></i>
                                    <p>Loading orders...</p>
                                </div>
                                <div id="orders_empty" class="account_empty" style="display:none;">
                                    <i class="ion-bag" style="font-size:50px;color:#2d2d2d;"></i>
                                    <p>You haven't placed any orders yet.</p>
                                    <a href="../index.html" class="auth_btn auth_btn_small"
                                        style="display:inline-block;text-align:center;">
                                        Start Shopping
                                    </a>
                                </div>
                                <div id="orders_list"></div>
                            </div>

                            <!-- Settings Tab -->
                            <div class="account_tab_content" id="tab_settings">
                                <div class="settings_section">
                                    <h3>Account Information</h3>
                                    <div class="settings_row">
                                        <span class="settings_label">Name</span>
                                        <span class="settings_value" id="settings_name">-</span>
                                    </div>
                                    <div class="settings_row">
                                        <span class="settings_label">Email</span>
                                        <span class="settings_value" id="settings_email">-</span>
                                    </div>
                                    <div class="settings_row">
                                        <span class="settings_label">Phone</span>
                                        <span class="settings_value" id="settings_phone">-</span>
                                    </div>
                                    <div class="settings_row">
                                        <span class="settings_label">Member Since</span>
                                        <span class="settings_value" id="settings_since">-</span>
                                    </div>
                                </div>
                                <div class="settings_section">
                                    <h3>Danger Zone</h3>
                                    <button class="auth_btn" style="background:#dc3545;max-width:200px;"
                                        onclick="Auth.logout()">
                                        Logout
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div style="text-align:center;margin-top:25px;">
                            <a href="../index.html" class="back_home">
                                <i class="ion-arrow-left-c"></i> Back to Home
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script src="../js/github-db.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/cart.js"></script>
    <script>
        // Redirect if not logged in
        if (!Auth.isLoggedIn()) {
            window.location.href = 'login.html';
        }

        // Populate user info
        const user = Auth.getUser();
        if (user) {
            document.getElementById('account_name').textContent = user.name;
            document.getElementById('account_email').textContent = user.email;
            document.getElementById('account_phone').textContent = user.phone || '';
            document.getElementById('settings_name').textContent = user.name;
            document.getElementById('settings_email').textContent = user.email;
            document.getElementById('settings_phone').textContent = user.phone || 'Not provided';
            document.getElementById('settings_since').textContent = 'Member';
        }

        // Tab switching
        document.querySelectorAll('.account_tab').forEach(function (tab) {
            tab.addEventListener('click', function () {
                document.querySelectorAll('.account_tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.account_tab_content').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                document.getElementById('tab_' + this.dataset.tab).classList.add('active');
            });
        });

        // Load orders
        (async function () {
            try {
                const orders = await Cart.getOrders();
                document.getElementById('orders_loading').style.display = 'none';

                if (orders.length === 0) {
                    document.getElementById('orders_empty').style.display = 'block';
                    return;
                }

                const list = document.getElementById('orders_list');
                orders.reverse().forEach(function (order) {
                    const date = new Date(order.createdAt).toLocaleDateString('en-IN', {
                        year: 'numeric', month: 'long', day: 'numeric'
                    });
                    const itemsHtml = order.items.map(function (item) {
                        return `<span class="order_item_tag">${item.name} x${item.qty}</span>`;
                    }).join('');

                    const div = document.createElement('div');
                    div.className = 'order_card';
                    div.innerHTML = `
                        <div class="order_header">
                            <div>
                                <span class="order_id">${order.id}</span>
                                <span class="order_date">${date}</span>
                            </div>
                            <span class="order_status status_${order.status}">${order.status}</span>
                        </div>
                        <div class="order_items">${itemsHtml}</div>
                        <div class="order_total">Total: Rs. ${order.total.toLocaleString('en-IN')}</div>
                    `;
                    list.appendChild(div);
                });
            } catch (err) {
                document.getElementById('orders_loading').innerHTML =
                    '<p style="color:#dc3545;">Failed to load orders.</p>';
                console.error(err);
            }
        })();
    </script>
</body>

</html>
